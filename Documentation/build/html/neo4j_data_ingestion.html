<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ingesting data into Neo4j &mdash; Twitter Analytics 0.1 documentation</title>
  

  
  

  

  

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/jquery-ui/jquery-ui.min.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/t3more.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Twitter Analytics 0.1 documentation" href="#"/>
        <link rel="next" title="Ingesting data into MongoDB" href="mongoDB_data_ingestion.html"/>
        <link rel="prev" title="Read data from Twitter API" href="twitter_stream.html"/> 
  <script src="_static/js/modernizr.min.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        <ul class="sidebartop">

          <li class="docsite">
            <a href="https://docs.typo3.org"><img src="_static/img/typo3-documentation.png" class="logo" /></a>
          </li>

          <li class="project">
            <a href="index.html">
              Twitter Analytics<br>0.1</a>
          </li><li class="nolink search">
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div></li>

        </ul>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to twitter analytics system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#major-parts-of-the-system">Major parts of the system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="twitter_stream.html">Read data from Twitter API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#user-timeline-api">User Timeline API</a></li>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#stream-sample-api">Stream Sample API</a></li>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#user-timeline-api-code-documentation">User Timeline API Code Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#stream-sample-api-code-documentation">Stream Sample API Code Documentation</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ingesting data into Neo4j</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-stored-in-neo4j">Data stored in neo4j</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-network">User network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tweet-network">Tweet network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexing-network">Indexing network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ingesting-the-data-into-neo4j-logic">Ingesting the data into neo4j : Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#improving-ingestion-rate-using-transaction">Improving ingestion rate using transaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexing">Indexing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-ingestion-script">Running the ingestion script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#neo4j-ingestion-rates">Neo4j Ingestion Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-documentation-for-neo4j-data-ingestion">Code Documentation for Neo4j data ingestion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mongoDB_data_ingestion.html">Ingesting data into MongoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#why-store-in-mongodb">Why store in MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#data-format-in-mongodb">Data Format in mongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#mongodb-v-s-neo4j">mongoDB v/s neo4j</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#ingesting-the-data-into-mongodb-logic">Ingesting the data into mongoDB : Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_data_ingestion.html#improving-ingestion-rate-using-transactions">Improving ingestion rate using transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_data_ingestion.html#improving-ingestion-rate-using-parallel-multiple-process">Improving ingestion rate using parallel multiple process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#ingesting-the-data-into-mongodb-practical-side">Ingesting the data into mongoDB : Practical side</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#mongodb-ingestion-rates">MongoDB Ingestion Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#module-ingest_raw">Code Documentation for mongoDB ingestion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="neo4j_query_generation.html">Neo4j: API to generate cypher queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#template-of-a-general-query">Template of a general query</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#basic-abstraction">Basic Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#naming-entities">Naming entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#variable-attributes">Variable attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#returns">Returns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#creating-a-custom-query-through-dashboard-api-behind-the-scenes">Creating a custom query through dashboard API : Behind the scenes</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#code-documentation-for-neo4j-query-generation">Code Documentation for Neo4j query generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mongoDB_query_generation.html">Generating queries in mongoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_query_generation.html#generic-api-for-mongodb-idea">Generic API for mongoDB : Idea</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_query_generation.html#mongodb-query-execution-code-documentation">MongoDB query execution code documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">About Post processing functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#need-of-post-processing-function">Need of post processing function</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#format-of-post-processing-functions">Format of post processing functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#executing-post-processing-function">Executing post processing function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dag.html">Composing multiple queries : DAG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dag.html#basic-terminology">Basic terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#idea-behind-a-dag">Idea behind a DAG</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#building-a-dag-from-queries">Building a DAG from queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#dag-in-airflow">DAG in airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#creating-custom-metric">Creating custom metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#code-documentation-for-dag-abstraction">Code Documentation for DAG abstraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flink.html">Generating alerts using Apache Flink and Kafka</a><ul>
<li class="toctree-l2"><a class="reference internal" href="flink.html#flink-code-documentation">Flink Code Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarking.html">Benchmarking the query answering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#neo4j-queries">Neo4j queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="benchmarking.html#simple-queries">Simple Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="benchmarking.html#complex-queries">Complex Queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#mongodb-queries">MongoDB queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#code-documentation-for-benchmarking">Code Documentation for benchmarking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard_website.html">Dashboard Website</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboard_website.html#major-parts-of-the-dashboard-website">Major parts of the dashboard website</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#hashtags">Hashtags</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#mentions">Mentions</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#urls">URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#alerts">Alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#dag">DAG</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dashboard_website.html#use-cases">Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-top-10-popular-hashtags">Viewing top 10 popular hashtags</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-usage-history-of-hashtag">Viewing usage history of  hashtag</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-sentiment-history-of-hashtag">Viewing sentiment history of  hashtag</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#creating-a-mongodb-query">Creating a mongoDB query</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#creating-neo4j-queries">Creating neo4j queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-post-processing-function">Create Post processing function</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-queries">View Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-dag">Create DAG</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-dags">View DAGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-custom-metric">Create Custom metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-alert">Create Alert</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-alerts">View Alerts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Getting the system running</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#setting-up-the-environment">Setting up the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#running-the-dashboard">Running the dashboard</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Twitter Analytics</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    <li>Ingesting data into Neo4j</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/neo4j_data_ingestion.rst.txt" rel="nofollow">
                <span class="fa fa-binoculars"></span>&#32;View page source
            </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <div class="section" id="ingesting-data-into-neo4j">
<h1>Ingesting data into Neo4j<a class="headerlink" href="#ingesting-data-into-neo4j" title="Permalink to this headline">¶</a></h1>
<div class="section" id="data-stored-in-neo4j">
<h2>Data stored in neo4j<a class="headerlink" href="#data-stored-in-neo4j" title="Permalink to this headline">¶</a></h2>
<p>Our aim in the project is to capture the dynamics of an evolving social network. These dynamics can be a combination of :</p>
<blockquote>
<div><ul class="simple">
<li>Spatial dynamics : captured by network based information.</li>
<li>Temporal dynamics : The spatial information present at some interval of time in the past. This makes sense as the network keeps on changing and the user might want to see the state of some part of it at some point in past.</li>
</ul>
</div></blockquote>
<p>We store the complete twitter network in graph database neo4j.</p>
<p>For sake of understanding, lets divide the complete network into three parts:</p>
<blockquote>
<div><ul class="simple">
<li>User network : Stores the user information and connections between the user nodes</li>
<li>Tweet network : Stores the tweets, their attributes and interconnections between tweets and their connections with user nodes as well.</li>
<li>Indexing network : Stores the time indexing structure utilized to answer queries having a temporal dimension. Its instructive to imagine the user and tweet network on a plane and the indexing network on top of this plane.</li>
</ul>
</div></blockquote>
<p>Let’s look at these networks in some detail</p>
<div class="section" id="user-network">
<h3>User network<a class="headerlink" href="#user-network" title="Permalink to this headline">¶</a></h3>
<p>The user network contains following nodes:</p>
<blockquote>
<div><ul class="simple">
<li>USER node : It contains user_id and screen_name.</li>
<li>USER_INFO node: It contains the user info like number of followers/friends, number of tweets, location and other meta data. These nodes form a link list in which new nodes are added, when information of the user is collected.</li>
</ul>
</div></blockquote>
<img alt="_images/neo_in3.png" src="_images/neo_in3.png" />
<img alt="_images/neo_in2.png" src="_images/neo_in2.png" />
</div>
<div class="section" id="tweet-network">
<h3>Tweet network<a class="headerlink" href="#tweet-network" title="Permalink to this headline">¶</a></h3>
<p>The tweet network contains following nodes:</p>
<blockquote>
<div><ul class="simple">
<li>TWEET node : It contains the tweet info like its id, the raw text of the tweet, the location from which the tweet is made(currently we are storing it in raw fashion, which in future can be extended by creating LOCATION nodes just like HASHTAG et al.)</li>
<li>HASHTAG node : It contains the text of the hashtag.</li>
<li>URL node : Contains the full and the shortened url.</li>
</ul>
</div></blockquote>
<img alt="_images/neo_in1.png" src="_images/neo_in1.png" />
</div>
<div class="section" id="indexing-network">
<h3>Indexing network<a class="headerlink" href="#indexing-network" title="Permalink to this headline">¶</a></h3>
<p>The Indexing network contains:</p>
<blockquote>
<div><ul class="simple">
<li>RUN node : It is a unique node in the entire network. Just a starting placeholder for the root of the indexing structure.</li>
<li>FRAME node : A frame time interval is to be specified by the user. Each frame indexes time slices equal to the specified interval.</li>
<li>FOLLOW_EVENT node : represents that Follower started following Followee.</li>
<li>UNFOLLOW_EVENT node : represents that Unfollower stopped following Unfollowee.</li>
<li>TWEET_EVENT node : represents that user tweeted tweet.</li>
</ul>
</div></blockquote>
<img alt="_images/neo_in4.png" src="_images/neo_in4.png" />
</div>
</div>
<div class="section" id="ingesting-the-data-into-neo4j-logic">
<h2>Ingesting the data into neo4j : Logic<a class="headerlink" href="#ingesting-the-data-into-neo4j-logic" title="Permalink to this headline">¶</a></h2>
<p>We get a tweet from the twitter firehose. One simple thing could be to make a connection to the on-disk database and insert the tweet. This can be achieved using <cite>session.run(&lt;cypher tweet insertion query&gt;)</cite>, because run in neo4j emulates a auto-commit transaction.</p>
<div class="section" id="improving-ingestion-rate-using-transaction">
<h3>Improving ingestion rate using transaction<a class="headerlink" href="#improving-ingestion-rate-using-transaction" title="Permalink to this headline">¶</a></h3>
<p>A simple way to make this more efficient would be the use of transactions. The idea behind using transactions is to keep on accumulating the incoming tweets in a graph in memory. After some fixed number of tweets, the transaction is committed to the disk. Clearly this leads to faster ingestion rate:</p>
<blockquote>
<div><ul class="simple">
<li>Accumulating to memory and then writing the batch to disk is faster as compared to writing tweet by tweet to disk due to the efficiency in disk head seaks.</li>
<li>Further, when creating the in-memory local graph from the transaction batch, neo4j does some changes in the order in which to write the changes to ensure efficiency.</li>
</ul>
</div></blockquote>
<p>But, the clear downside of this is that the queries being answered will lag behind at most the transaction size. This happens because the tweets are being inserted in real time manner and the queries are also being answered simultaneously. But this is not a major issue as it induces a lag of only &lt;10 secs(assuming transaction size of ~30k).</p>
</div>
<div class="section" id="indexing">
<h3>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h3>
<p>We create uniqueness constraints on the following attributes of these nodes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head">Attribute</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>FRAME</td>
<td>start_t</td>
</tr>
<tr class="row-odd"><td>TWEET</td>
<td>id</td>
</tr>
<tr class="row-even"><td>USER</td>
<td>id</td>
</tr>
<tr class="row-odd"><td>HASHTAG</td>
<td>text</td>
</tr>
<tr class="row-even"><td>URL</td>
<td>url</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="running-the-ingestion-script">
<h2>Running the ingestion script<a class="headerlink" href="#running-the-ingestion-script" title="Permalink to this headline">¶</a></h2>
<p>To ingest data into neo4j, navigate to the Ingestion/Neo4j and make changes to the file ingest_neo4j.py. Specifically, provide the folder containing the tweets containing files. We are simulating the twitter stream by reading the tweets from a file on the disk and storing those in memory. This makes sense as we can’t possibly get tweets from the twitter hose at a rate greater than reading from memory, thus this in no way can be a bottleneck to the ingestion rate. Then just run the we need to run the file <cite>python ingest_neo4j.py</cite> to start ingesting. A logs file will be created which will keep on updating to help the user gauze the ingestion rate.</p>
</div>
<div class="section" id="neo4j-ingestion-rates">
<h2>Neo4j Ingestion Rates<a class="headerlink" href="#neo4j-ingestion-rates" title="Permalink to this headline">¶</a></h2>
<img alt="_images/neo_in5.png" src="_images/neo_in5.png" />
<p>Observe that the ingestion rate peaks at 1000 tweets/sec at a transaction size of around 35k. This is mainly due to the limitation of memory size. The authors observe that keeping a larger transaction size leads to lag on the system indicative of use of swap space. Thus, the maximum ingestion rate can be enhanced just by putting in more memory, albeit with decreasing returns.</p>
</div>
<div class="section" id="code-documentation-for-neo4j-data-ingestion">
<h2>Code Documentation for Neo4j data ingestion<a class="headerlink" href="#code-documentation-for-neo4j-data-ingestion" title="Permalink to this headline">¶</a></h2>
<p>Here we provide a documentation of the code.</p>
<span class="target" id="module-ingest_neo4j"></span><p>Module to insert data into neo4j database.</p>
<p>The <a class="reference internal" href="#module-ingest_neo4j" title="ingest_neo4j"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ingest_neo4j</span></code></a> module contains the classes:</p>
<ul class="simple">
<li><a class="reference internal" href="#ingest_neo4j.Twitter" title="ingest_neo4j.Twitter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ingest_neo4j.Twitter</span></code></a></li>
</ul>
<p>One can use the <code class="xref py py-func docutils literal notranslate"><span class="pre">ingest_neo4j.Twitter.ingest_tweet()</span></code> to insert a new tweet into the database.</p>
<p>An example usage where we want to insert all tweets from all files in a folder tweet_folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Twitter</span><span class="p">(</span><span class="mi">50000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">get_constraints</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">get_profile</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">read_tweets</span><span class="p">(</span><span class="o">&lt;</span><span class="n">tweet_folder</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">get_profile</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>
</pre></div>
</div>
<dl class="class">
<dt id="ingest_neo4j.Twitter">
<em class="property">class </em><code class="descclassname">ingest_neo4j.</code><code class="descname">Twitter</code><span class="sig-paren">(</span><em>batch_size=200</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class containing functions to insert tweets into neo4j.
We open a connection to the neo4j database through py2neo and the official
neo4j driver. Dealing with transactions is easy in py2neo, so it is used to make and commit transactions. While
the connection to the neo4j driver is used just in clearing out the graph.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>batch_size</strong> – number of tweets to take into transaction before commiting it</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ingest_neo4j.Twitter.clear_graph">
<code class="descname">clear_graph</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.clear_graph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.clear_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the complete graph. Albiet, keep the indices.</p>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.close" title="Permalink to this definition">¶</a></dt>
<dd><p>See if there are some tweets not comitted in the trnx and if yes, commit those.</p>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.close_session">
<code class="descname">close_session</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.close_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.close_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the neo4j driver session</p>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.create_constraint">
<code class="descname">create_constraint</code><span class="sig-paren">(</span><em>node</em>, <em>attrib</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.create_constraint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.create_constraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Create constraint on attrib in node node</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>node</strong> – node type on which to create the constraint</td>
</tr>
<tr class="field-even field"><th class="field-name">Parem attrib:</th><td class="field-body">node attibute whose constraint is to be created</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.create_constraints">
<code class="descname">create_constraints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.create_constraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.create_constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Create uniqueness constraints on the attributes of nodes. Note that ceating a constraint automatically
creates an index on it</p>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.drop_constraint">
<code class="descname">drop_constraint</code><span class="sig-paren">(</span><em>node</em>, <em>attrib</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.drop_constraint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.drop_constraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop constraint on attrib in node node</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>node</strong> – node type on which to delete the constraint</td>
</tr>
<tr class="field-even field"><th class="field-name">Parem attrib:</th><td class="field-body">node attibute whose constraint is to be deleted</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.get_constraints">
<code class="descname">get_constraints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.get_constraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.get_constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the constrainsts on different types of nodes.</p>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.get_profile">
<code class="descname">get_profile</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.get_profile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.get_profile" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of total, user, tweet, hashtag nodes in the graph</p>
</dd></dl>

<dl class="method">
<dt id="ingest_neo4j.Twitter.insert_tweet">
<code class="descname">insert_tweet</code><span class="sig-paren">(</span><em>tweet</em>, <em>favourited_by=None</em>, <em>fav_timestamp=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#Twitter.insert_tweet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.Twitter.insert_tweet" title="Permalink to this definition">¶</a></dt>
<dd><p>The main function to insert the tweet. Begin a transaction, when atleast batch_size number of tweets
are collected, commit the transaction. Start collecting the new tweets after that.</p>
<p>We have two cases depending if the tweet to be inserted is a
retweet or not. We mention the steps taken to insert the tweet in the two case:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>The tweet is a retweet</dt>
<dd><ul class="first last">
<li>Create a tweet_event under a appropriate frame</li>
<li>Merge node for this tweet. Maybe the tweet node already partially exists because some other tweet is its reply.</li>
<li>Create favorite relation if needed</li>
<li>Proceed only if the tweet was not already created</li>
<li>Create user and then the relationships</li>
<li>Find node of original tweet and link</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The tweet is not a retweet</dt>
<dd><ul class="first last">
<li>Create a tweet_event under a appropriate frame</li>
<li>Merge node for this tweet</li>
<li>Create favorite relation if needed</li>
<li>Proceed only if the tweet was not already created</li>
<li>Create user and then the relationships</li>
<li>Create links to hashtags, mentions, urls</li>
<li>Create link to quoted tweet in case this tweet quotes another tweet</li>
<li>Create link to original tweet in case this is a reply tweet</li>
</ul>
</dd>
</dl>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>tweet</strong> – the json of the tweet to be inserted</li>
<li><strong>favourited_by</strong> – userid of the user who favourited the tweet</li>
<li><strong>fav_timestamp</strong> – time at which the tweet was favourited</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Currently we are making use of transactions only. We get decent peak ingestion rate of
around 1000 tweets/sec. But this can be increased by overlapping the collection and ingestion part as
we do in case of mongoDB. But the same scheme can’t be used here as the transaction created is not
a native python object and hance can’t be passed between python multiprocessing module processes. So, one
idea is to create a csv with the tweets, and then call the use_csv function in neo4j to ingest. But this is a
contrived way of doing this by doing same task twice.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="ingest_neo4j.flatten_json">
<code class="descclassname">ingest_neo4j.</code><code class="descname">flatten_json</code><span class="sig-paren">(</span><em>json_obj</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#flatten_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.flatten_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to flatten the tweet. Used in case we want to store the complete tweet JSON in the TWEET node.
This is because neo4j doesn’t allow nested jsons to be stored</p>
</dd></dl>

<dl class="function">
<dt id="ingest_neo4j.getDateFromTimestamp">
<code class="descclassname">ingest_neo4j.</code><code class="descname">getDateFromTimestamp</code><span class="sig-paren">(</span><em>timestamp</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#getDateFromTimestamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.getDateFromTimestamp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ingest_neo4j.getFrameStartEndTime">
<code class="descclassname">ingest_neo4j.</code><code class="descname">getFrameStartEndTime</code><span class="sig-paren">(</span><em>timestamp</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#getFrameStartEndTime"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.getFrameStartEndTime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ingest_neo4j.log">
<code class="descclassname">ingest_neo4j.</code><code class="descname">log</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#log"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.log" title="Permalink to this definition">¶</a></dt>
<dd><p>Why use this when we can use logging? There is a peculiar bug when open neo4j bolt server with logging</p>
</dd></dl>

<dl class="function">
<dt id="ingest_neo4j.read_tweets">
<code class="descclassname">ingest_neo4j.</code><code class="descname">read_tweets</code><span class="sig-paren">(</span><em>path</em>, <em>twitter</em>, <em>filename=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_neo4j.html#read_tweets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_neo4j.read_tweets" title="Permalink to this definition">¶</a></dt>
<dd><p>Read tweets from the directory in path and inert all tweets in all files in the first level of path into
neo4j.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> – the path of the directory</li>
<li><strong>twitter</strong> – a Twitter object</li>
<li><strong>filename</strong> – optional, if want to insert tweets from a single file</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


           </div><!-- /.toBeIndexed -->
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mongoDB_data_ingestion.html" class="btn btn-neutral float-right" title="Accesskey Alt(+Shift)+n" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="twitter_stream.html" class="btn btn-neutral" title="Accesskey Alt(+Shift)+p" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="contentinfo">
      <p class="show_source">
        <a href="_sources/neo4j_data_ingestion.rst.txt" rel="nofollow">
          <span class="fa fa-binoculars"></span>&#32;View page source
        </a>
      </p>
      <p class="show_copyright">
            &copy; Copyright 2018, Deepak Saini, Abhishek Gupta
      </p>
      <p class="show_sphinx">
        Built with <a href="http://sphinx-doc.org/" target="_blank">Sphinx</a> and
        <a href="https://github.com/TYPO3-Documentation/t3SphinxThemeRtd" target="_blank">t3SphinxThemeRtd.</a>
        Report theme issues <a href="https://github.com/TYPO3-Documentation/t3SphinxThemeRtd/issues" target="_blank">here.</a>
      </p>
      <p class="show_legalinfo">
        <a href="https://typo3.org/legal-info/" rel="nofollow">
          <span class="fa fa-legal"></span>&#32;Legal Info
        </a>
      </p>




  </div>

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="_static/jquery-ui/jquery-ui.min.js"></script>
      <script type="text/javascript" src="_static/js/theme.js"></script>
      <script type="text/javascript" src="_static/js/t3autocomplete.js"></script>

  

  
   
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   <script type="text/javascript" id="idPiwikScriptPlaceholder"></script></body>
</html>